import pygame
from pygame.locals import *
from sys import exit
from random import randint


pygame.init()

# criando tela
largura = 600
altura = 600
tela = pygame.display.set_mode((largura, altura))
pygame.display.set_caption('Jogo')

# variaveis iniciais
cianos = vermelhos = marrons = 0
vivo = True
imortal = False
velocidade = 8
velocidade_vilao = 4
x_controle = 0
y_controle = 0
controlex_vilao = 0
controley_vilao = 0
lista_coletaveis = []

relogio = pygame.time.Clock()
fonte = pygame.font.SysFont('arial', 25, bold=True, italic=True)
fonte2 = pygame.font.SysFont('arial', 16, bold=True, italic=True)
fonte_placar = pygame.font.SysFont('arial', 15, True, True)


class Player:
    def __init__(self, cor, pos_x, pos_y):
        self.cor = cor
        self.pos_x = pos_x
        self.pos_y = pos_y

    def andar(self):
        global x_controle, y_controle
        if event.key == K_LEFT:
            x_controle = -velocidade
            y_controle = 0
        if event.key == K_RIGHT:
            x_controle = velocidade
            y_controle = 0
        if event.key == K_UP:
            x_controle = 0
            y_controle = -velocidade
        if event.key == K_DOWN:
            x_controle = 0
            y_controle = velocidade
        if player.pos_x > largura:
            player.pos_x = 0
        if player.pos_x < 0:
            player.pos_x = largura
        if player.pos_y > altura:
            player.pos_y = 0
        if player.pos_y < 0:
            player.pos_y = altura

    def colidiu(self, coletavel):
        global Coletaveis, cianos, vermelhos, marrons, velocidade, imortal
        if coletavel.centro_x -30 <  player.pos_x and player.pos_x < coletavel.centro_x + 10:
            if coletavel.centro_y - 20 < player.pos_y and player. pos_y < coletavel.centro_y + 10:
                coletavel.centro_x = randint(0,largura-10)
                coletavel.centro_y = randint(51,altura-10)
                if coletavel == vermelho:
                    vermelhos += 1
                    velocidade += 3
                    if imortal == True:
                        imortal = False
                if coletavel == ciano:
                    cianos += 1
                    imortal = True
                    self.cor = (255,255,255)
                if coletavel == marrom:
                    marrons += 1
                    velocidade -= 3
                    if imortal == True:
                        imortal = False
    def desenhar(self):
        pygame.draw.rect(tela, (0,0,255), (self.pos_x, self.pos_y, 25, 25))

class Coletaveis:
    def __init__(self, cor, centro_x, centro_y, raio):
        self.cor = cor
        self.centro_x = centro_x
        self.centro_y = centro_y
        self.raio = raio

    def desenhar_coletaveis(self):
        pygame.draw.circle(tela, self.cor, (self.centro_x, self.centro_y), self.raio)

class Vilao():
    def __init__(self, cor, pos_x, pos_y):
        self.cor = cor
        self.pos_x = pos_x
        self.pos_y = pos_y

    def desenhar_vilao(self):
        pygame.draw.rect(tela, self.cor, (self.pos_x, self.pos_y, 20, 20))

    def perseguir(self):
        global player, controlex_vilao, controley_vilao, vivo
        if self.pos_x < player.pos_x:
            controlex_vilao = velocidade_vilao

        if self.pos_x > player.pos_x:
            controlex_vilao = -velocidade_vilao

        if self.pos_y < player.pos_y:

            controley_vilao = velocidade_vilao
        else:
            controley_vilao = -velocidade_vilao
        if player.pos_x - 20 < self.pos_x < player.pos_x + 20 and not imortal :
            if player.pos_y - 20 < self.pos_y < player.pos_y + 20:
                vivo = False
def reiniciar_jogo():
    global menu
    menu = True

menu = True
while menu:
    tela.fill((0, 0, 0))

    inicio = ('Pressione a barra de espaÃ§o para iniciar')
    texto_formatado3 = fonte.render(inicio, True, (255, 255, 255))
    tela.blit(texto_formatado3, (100, altura / 2))
    pygame.display.update()
    for event in pygame.event.get():
        if event.type == QUIT:
            exit()
        if event.type == KEYDOWN:
            if event.key == K_SPACE:
                menu = False

    pygame.display.update()

player = Player((0,0,255), largura//2, altura//2 )
inimigo = Vilao((255, 255, 0), largura-20, altura-20 )
vermelho = Coletaveis((255, 0, 0), randint(0, largura - 30), randint(0,altura - 30), 5)
ciano = Coletaveis((0, 255, 255), randint(0, largura - 30), randint(0,altura - 30), 5)
marrom = Coletaveis((0, 255, 0), randint(0, largura - 30), randint(0,altura - 30), 5)
lista_coletaveis.append(ciano)
lista_coletaveis.append(vermelho)
lista_coletaveis.append(marrom)

while vivo:
    tela.fill((0,0,0))
    mensagem = (f'Cianos: {cianos} | Marrons:{marrons} | Vermelhos:{vermelhos}')
    texto_formatado = fonte_placar.render(mensagem, True, (255, 255, 255), True)
    relogio.tick(30)
    player.desenhar()
    vermelho.desenhar_coletaveis()
    ciano.desenhar_coletaveis()
    marrom.desenhar_coletaveis()
    inimigo.desenhar_vilao()

    for event in pygame.event.get():
        if event.type == QUIT:
            exit()
        if event.type == KEYDOWN:
            player.andar()
    for coletavel in lista_coletaveis:
        player.colidiu(coletavel)

    player.pos_x += x_controle
    player.pos_y += y_controle
    inimigo.pos_x += controlex_vilao
    inimigo.pos_y += controley_vilao

    if player.pos_x > largura:
        player.pos_x = 0
    if player.pos_y > altura:
        player.pos_y = 0
    if player.pos_x < 0:
        player.pos_x = 600
    if player.pos_y < 0:
        player.pos_y = 600
    inimigo.perseguir()
    tela.blit(texto_formatado, (20, altura // 20))
    if vivo == False:
        reiniciar_jogo()
    pygame.display.update()
